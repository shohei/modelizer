# Create your views here.
from django.shortcuts import render_to_response
from django.template import RequestContext
import serial
from control.models import Camfile
from django.http import HttpResponse
import logging

logger = logging.getLogger(__name__)

def index(request):
    port = serialOpen
    if request.POST:
        mil = request.POST['milData']
        drl = request.POST['drlData']
        dim = request.POST['dimData']
        newCam = Camfile(milData=mil,drlData=drl,dimData=dim)
        newCam.save()
        return render_to_response('control/index.html',{'port':port,'mil':mil,'drl':drl,'dim':dim},context_instance=RequestContext(request))
    else:
        return render_to_response('control/index.html',{'port':port},context_instance=RequestContext(request))


def serialOpen():
    com = serial.Serial(port=29,baudrate=9600,bytesize=8,parity='N',stopbits=1,timeout=None,xonxoff=0,rtscts=True,writeTimeout=None,dsrdtr=True)
    return com.portstr                                                     -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
+-50152345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210310410510610710810911011111211311411511611711811912012112212312412512612712812913013113213313413513613713813914014114214314414514614714814915015115215315415515615715815916016116216316416516616716816917017117217317417517617717817918018118218318418518618718818919019119219319419519619719819920020120220320420520620720820921021121221321421521621721821922022122222322422522622722822923023123223323423523623723823924024124224324424524624724824925025125225325425525625725825926026126226326426526626726826927027127227327427527627727827928028128228328428528628728828929029129229329429529629729829930030130230330430530630730830931031131231331431

def hellotest(request):
    return HttpResponse("hello world")

def milUpload(request):
    if request.POST:
        milData = request.POST['milData']
    else:
        print("HOGE request")
        milData = "no data available"
    return render_to_response('control/index.html',{'milData':"no data available"},context_instance=RequestContext(request))


def drlUpload(request):
    if request.method == 'POST':
        drldata = request.POST['drill']

    else:
        drldata = "no data available"
    return HttpResponse("hello drilling world")

def dimUpload(request):
    if request.POST:
        dimdata = request.POST['dim']
    else:
        dimdata = "no data available"
    return HttpResponse("hello dimension world")


def startMilling(request):
    if request.POST:
        milData = request.POST['milData']
        print(milData)
        driveModela(milData)
    return render_to_response('control/index.html',{},context_instance=RequestContext(request))


def driveModela(rmlData):
    com = serial.Serial(port=2,baudrate=9600,bytesize=8,parity='N',stopbits=1,timeout=None,xonxoff=0,rtscts=True,writeTimeout=None,dsrdtr=True)
    print(com.portstr)
    com.write(rmlData)
    com.close()
